<div class="container-fluid p-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">实验室药品库存管理</h5>
        </div>
        
        <div class="card-body">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>药品名称</th>
                        <th>CAS编号</th>
                        <th>分类</th>
                        <th>库存量</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="chemicalsTable">
                    <!-- 动态数据加载 -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/chemicals/list')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('chemicalsTable');
            data.forEach(item => {
                const row = `
                    <tr data-bs-toggle="collapse" data-bs-target="#detail-${item.id}">
                        <td>${item.name}</td>
                        <td>${item.casNumber || 'N/A'}</td>
                        <td>${item.classification}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: ${(item.currentStock/item.maxThreshold*100).toFixed(2)}%; 
                                            background-color: ${getStockColor(item.currentStock, item.minThreshold)}">
                                    ${item.currentStock}/${item.maxThreshold}
                                </div>
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" 
                                    onclick="location.href='/chemicals/edit/${item.id}'">
                                编辑
                            </button>
                        </td>
                    </tr>
                    <tr class="collapse" id="detail-${item.id}">
                        <td colspan="5">
                            <div class="p-3 bg-light">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5 class="text-primary mb-3">基本属性</h5>
                                        <dl class="row">
                                            <dt class="col-sm-4">英文名称</dt>
                                            <dd class="col-sm-8">${item.englishName || 'N/A'}</dd>
                                            
                                            <dt class="col-sm-4">危险等级</dt>
                                            <dd class="col-sm-8">
                                                <span class="badge ${getHazardBadgeClass(item.hazardClass)}">
                                                    ${item.hazardClass}
                                                </span>
                                            </dd>
                                        </dl>
                                    </div>
                                    <div class="col-md-6 border-start">
                                        <h5 class="text-primary mb-3">库存详情</h5>
                                        <dl class="row">
                                            <dt class="col-sm-4">最后操作人</dt>
                                            <dd class="col-sm-8">${item.lastModifiedBy || '系统'}</dd>
                                            
                                            <dt class="col-sm-4">存储条件</dt>
                                            <dd class="col-sm-8">${item.storageCondition || '常温'}</dd>
                                        </dl>
                                    </div>
                                </div>
                                <div class="mt-3 pt-3 border-top">
                                    <h5 class="text-primary">安全说明</h5>
                                    <p class="text-muted">${item.safetyDescription || '暂无安全说明'}</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        });
});

function getStockColor(current, min) {
    return current <= min ? '#dc3545' : 
           current <= min * 1.2 ? '#ffc107' : '#28a745';
}

function getHazardBadgeClass(hazard) {
    const map = {
        '高危': 'bg-danger',
        '中等': 'bg-warning',
        '一般': 'bg-success'
    };
    return map[hazard] || 'bg-secondary';
}
</script>